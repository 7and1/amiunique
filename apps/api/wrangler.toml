# AmiUnique.io API Worker Configuration
# NOTE: account_id is NOT included here for security (public repo)
# Set CLOUDFLARE_ACCOUNT_ID environment variable when deploying
name = "amiunique-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
workers_dev = true

# Local dev server port
[dev]
port = 8787

# Environment variables
[vars]
ENVIRONMENT = "development"

# D1 Database binding - Create your own database:
# wrangler d1 create amiunique-db
[[d1_databases]]
binding = "DB"
database_name = "amiunique-db"
# Replace with your D1 database ID after creation
database_id = "YOUR_D1_DATABASE_ID"

# KV Namespace for distributed rate limiting
# Create your own KV namespace:
# wrangler kv:namespace create "RATE_LIMIT_KV"
# wrangler kv:namespace create "RATE_LIMIT_KV" --preview
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
# Replace with your KV namespace IDs after creation
id = "YOUR_KV_NAMESPACE_ID"
preview_id = "YOUR_KV_PREVIEW_ID"

# Scheduled triggers for background jobs
# - Process deletion requests (GDPR compliance)
# - Refresh stats cache
[triggers]
crons = [
  "0 * * * *",   # Every hour: process deletion requests
  "*/5 * * * *"  # Every 5 minutes: refresh stats cache
]

# Production environment
[env.production]
name = "amiunique-api"
workers_dev = false

[env.production.vars]
ENVIRONMENT = "production"

[[env.production.d1_databases]]
binding = "DB"
database_name = "amiunique-db"
# Replace with your D1 database ID
database_id = "YOUR_D1_DATABASE_ID"

[[env.production.kv_namespaces]]
binding = "RATE_LIMIT_KV"
# Replace with your production KV namespace ID
id = "YOUR_PRODUCTION_KV_ID"

[env.production.triggers]
crons = [
  "0 * * * *",   # Every hour: process deletion requests
  "*/5 * * * *"  # Every 5 minutes: refresh stats cache
]

# Custom routes (uncomment after domain setup)
# [env.production.routes]
# { pattern = "api.amiunique.io/*", zone_name = "amiunique.io" }
